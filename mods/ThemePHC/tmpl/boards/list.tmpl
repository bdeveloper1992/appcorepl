	<a_cssx src="%%modpath%%/css/boards.css"/>
	
	<title><tmpl_var board_title> - Bulletin Boards</title>
	
	<!-- Board Title -->
	<h1><tmpl_var board_title></h1>
	
	<!-- Board Tagline -->
	<!--<p class='board-tagline'><tmpl_var board_tagline></p>-->
	
	<!-- Board Description -->
	<!--<tmpl_if description>
		<div id='board-intro'>
			<tmpl_var board_description>
		</div>
	</tmpl_if>-->
	
	<!-- Removed: "print list" link and script -->
	
	<!-- Removed: "delete list" link and script -->
	
	<!-- "Add a post" link -->
	<!--<a class='new_link' href='%%bin%%/<tmpl_var board_folder_name>/new'><img src='%%appcore%%/images/silk/add.png' align=absmiddle border=0> Add a new post to this forum!</a>-->
	
	
	<style type="text/css">
	textarea.expandText {
		/*line-height: 10px;*/
		/*height: 15px;*/
	}
	
	.newpost
	{
		cursor: default; 
		background: #e9eeff;
		border-bottom: 1px solid #c7cddf;
		border-top: 1px solid white;
		padding: 10px;
		
		padding-bottom: 30px;
	}
	
	.newpost .wrap
	{
		width: 30em;
		margin: 0 auto;
	}
	
	.newpost h2
	{
		color: #364a90;
		margin: 0; /*reset ...*/
		padding: 0;
		font-size: .7225em;
		font-weight: bold;
		text-align: center;
		/*background: #364a90;
		color: white;*/
		
	}
	
	.newpost .ident
	{
		color: #364a90;
		font-size: .7225em;
		float: left;
	}
	
	.newpost .controls
	{
		float: right;
	}
	
	#postas_form table
	{
		border-collapse: collapse; 
	}
	
	#postas_form td
	{
		color: #364a90;
		font-size: .7225em;
		padding: 0;
	}
	
	#postas_form 
	{
		display: none;
		margin-top: -1px;
	}
	
	.newpost textarea, 
	.newpost input
	{
		/*border: 1px solid #364a90;*/
		border: 1px solid #b9c0da;
		
		/*-moz-box-shadow: 0px 0px 2px #000;*/
	}
	
	.newpost textarea:focus, 
	.newpost input:focus
	{
		-moz-box-shadow: 0px 0px 9px #364a90;
		box-shadow: 0px 0px 9px #364a90;
	}
	
	.newpost input
	{
		margin-top: 2px;
	}
	
	</style>
	
	<!--max-height: 70px;-->
	<div class='newpost'>
	<!--action='%%binpath%%/post' method='POST'-->
		<form class='wrap'  onsubmit='return ajax_post_new(this)'>
			<!--<input type='hidden' name='poster_name' value='%%user_display%%'>
			<input type='hidden' name='poster_email' value='%%user_email%%'>-->
			<h2>Add a new post</h2>
			
			<div class='content'>
				<textarea class='expandText' style="width: 41.25em; height:5em" class="expandText" name="text"></textarea>
			</div>
			<div class='controls'>
				<button type='submit' class='button'>Post</button>
			</div>
			<div class='form' id='postas_form'>
				<table>
					<tr>
						<td>Name:</td>
						<td><input value='%%user_display%%' name='poster_name'></td>
					</tr>
					<tr>
						<td>Email:</td>
						<td><input value='%%user_email%%' name='poster_email'></td>
					</tr>
				</table>
			</div>
			<div class='ident' id='postas_display'>
				<script>
				function show_postas_form()
				{
					$("#postas_form").show(200);
					$("#postas_display").hide(200);
				}
				</script>
				Posting as <b>%%user_display%%</b> - <a href='javascript:void(show_postas_form());'>Change</a>
			</div>
		</form>
	</div>
	
	<script>
	
	function ajax_post_new(formElm)
	{
		var postData = {
			comment: formElm.text.value,
			poster_name: formElm.poster_name.value,
			poster_email: formElm.poster_email.value,
			output_fmt: "json"
		};
		
		$("#post-placeholder").show();
		
		var errorFunc = function() 
		{
			$("#post-placeholder").hide();
			if(confirm("There was an error saving your post to the server - nothing was saved. Do you want to use the simple post page instead of this fancy page to make your post?"))
			{
				document.location.href = "%%binpath%%/%%board_folder_name%%/new?text=" + postData.text; 
			}
		}
		
		var postUrl = "%%binpath%%/%%board_folder_name%%/post";
		//alert(postUrl);
		$.ajax({
			type: "POST",
			url: postUrl,
			data: postData,
			success: function(data)
			{
				//alert("Got post data:"+data+", type:"+typeof(data));
				if(typeof(data) == "string")
				{
					// something wierd on server - should be JSON!
					errorFunc();
				}
				else
				{
					//alert(data);
					//console.debug(data);
					$("#post-tmpl").tmpl(data).insertAfter("#post-placeholder");
					$("#post-placeholder").hide();
					formElm.text.value = "";
				}	
			},
			error: errorFunc,
			
		});
		
		return false;
	}
	</script>
		
	<script id="post-tmpl" type="text/x-jquery-tmpl">
		<tr href='%%binpath%%/%%board_folder_name%%/${folder_name}' class='post' id='post${postid}'> <!-- onclick='document.location.href=this.getAttribute("href")'>-->
			<td valign='top' align='center' class='photo'>
				<img class='user_photo' src='http://www.gravatar.com/avatar/${poster_email_md5}?d=${CDN:/appcore/mods/User/images/male-fb-sq-50px.jpg}&s=50'>
			</td>
			<td valign='top' class='data'>
				<a href='%%binpath%%/%%board_folder_name%%/${folder_name}' class='title_link'>
					${subject}
				</a>
				
				<div class='posted_by'>
					<span class='by'>by</span> <span class='name'>${poster_name}</span>
				</div>
				
				<div class='post_text'>
					<div id='short_text_${postid}' class='short_text'>
						${short_text}
						<span class='more'>(<a href='%%binpath%%/%%board_folder_name%%/${folder_name}' class='more_link' onclick='return show_more_post(${postid})'>More...</a>)</span>
					</div>
					<div id='text_${postid}' class='long_text'>
						${text}
						<div class='more'>(<a href='#' class='more_link' onclick='return show_less_post(${postid})'>&laquo; Less</a>)</div>
					</div>
				</div>
				
				<div class='timestamp'>${timestamp}</div>
			</td>
		</tr>
	</script>
	

	
	<style>
	table.postlist
	{
		/*border-collapse:collapse;*/
		/*border: 1px solid #364a90; */
		/*-moz-box-shadow: 0px 0px 8px #000;*/
		/*-moz-box-shadow: 0 0 3px #fff, 0px 0px 8px #000;*/
		/*margin: 1em 0;*/
		border-spacing: 0;
	} 
	
	
	table.postlist th 
	{
		background: #364a90;
		color: white;
		text-shadow: rgb(8,8,8) 1px 1px 1px;
		font-weight: bold;
		padding: 2 4;
		text-align: left;
		
		/*border-bottom: 1px solid #364a90;*/
	}
	
	.postlist .user_photo
	{
		border: 1px solid #364a90;
		-moz-box-shadow: 0px 0px 3px #000;
	}
	
	table.postlist td 
	{
		/*border: 1px solid #364a90;*/
		/*padding: 2 4;*/
		cursor: pointer; 
		background: #e9eeff;
		border-bottom: 1px solid #c7cddf;
		border-top: 1px solid white;
	}
	
	.postlist td.photo
	{
		width: 60px;
		padding: 10px;
	}
	
	.postlist td img
	{
		cursor: default;
	}
	
	.postlist td.data
	{
		padding: 10px;
	}
	
	table.postlist tr:hover td
	{
		/*background: #c2cdf5;*/
	}
	
	table.postlist .util
	{
		color: #364a90;
	}

	.postlist .data .lastpost { display: none }
	.postlist .data .title_link { display: none; }
	
	.postlist .data .by {
		font-style: italic;
		/*font-weight: bold;*/
		font-size: .85em;
		
	} 
	
	.postlist .data .posted_by .name { font-weight: bold; }
	
	.postlist .data .posted_by,
	.postlist .data .timestamp 
	{
		color: #364a90;
		font-size: .85em;
	}
	
	.postlist .data .timestamp
	{
		font-size: .7225em;
	}
	
	.postlist .more
	{
		font-size: .7225em;
	}
	
	.postlist .post_text
	{
		/*-moz-box-shadow:inset 0 0 8px #000;
		-webkit-box-shadow:inset 0 0 8px #000;
		box-shadow:inset 0 0 8px #000;*/
		border-left: 2px solid #b9c0da;
		padding: 10px;

	}
	
	.long_text
	{
		display: none;
	}
	
	#post-placeholder { display: none; }
	
	</style>
	<script>
	function show_more_post(postid)
	{
		var shortId = "#short_text_"+postid;
		var longId = "#text_"+postid;
		$(shortId).hide(300);
		$(longId).show(300);
		return false;
	}
	
	function show_less_post(postid)
	{
		var shortId = "#short_text_"+postid;
		var longId = "#text_"+postid;
		var rowId = "tr.#post"+postid;
		$(shortId).show(300);
		$(longId).hide(300);
		// only scroll doc if top of the post is above the window top.
		// That way we dont "confuse" the user with unnecessary changes
		if($(rowId).offset().top < document.body.scrollTop)
			$.scrollTo($(rowId),300);
		return false;
	}
	</script>
	<table class='postlist' width='100%'>
		<tbody>
			<tr class='post post-placeholder' id='post-placeholder'>
				<td valign='top' align='center' class='photo'>
					<img class='user_photo' src="${CDN:/appcore/mods/User/images/male-fb-sq-50px.jpg}">
				</td>
				<td valign='top' class='data'>
					<img src='%%appcore%%/mods/ThemePHC/images/fb-ajax-loader.gif'>
				</td>
			</tr>
				
		<tmpl_loop posts>
			<tr href='%%binpath%%/<tmpl_var board_folder_name>/<tmpl_var folder_name>' class='post' id='post%%postid%%'> <!-- onclick='document.location.href=this.getAttribute("href")'>-->
				<td valign='top' align='center' class='photo'>
					<img class='user_photo' src="http://www.gravatar.com/avatar/%%poster_email_md5%%?d=${CDN:/appcore/mods/User/images/male-fb-sq-50px.jpg}&s=50">
				</td>
				<td valign='top' class='data'>
					<a href='%%binpath%%/<tmpl_var board_folder_name>/<tmpl_var folder_name>' class='title_link'>
						<tmpl_var subject>
					</a>
					
					<div class='posted_by'>
						<span class='by'>by</span> <span class='name'>%%poster_name%%</span>
					</div>
					
					<div class='post_text'>
						<div id='short_text_%%postid%%' class='short_text'>
							%%short_text%%
							<span class='more'>(<a href='%%binpath%%/<tmpl_var board_folder_name>/<tmpl_var folder_name>' class='more_link' onclick='return show_more_post(%%postid%%)'>More...</a>)</span>
						</div>
						<div id='text_%%postid%%' class='long_text'>
							%%text%%
							<div class='more'>(<a href='#' class='more_link' onclick='return show_less_post(%%postid%%)'>&laquo; Less</a>)</div>
						</div>
					</div>
					
					<div class='timestamp'>%%timestamp%%</div>
					
					<div class='lastpost'>
						<tmpl_if post_postid>
							<span class='post'>
								<a href='<tmpl_var post_url>'><tmpl_var post_subject></a><br>
								<span class='by'><tmpl_var post_timestamp> | <tmpl_var post_poster_name></span>
							</span>
						</tmpl_if>
					</div>
				</td>
			</tr>
		</tmpl_loop>
		</tbody>
	</table>


<script type="text/javascript">
// 	$(document).ready (function() {
// 		$('textarea.expandText').autogrow();
// 	});

$(function() {
          $('textarea').autogrow();
});

</script>

<script type="text/javascript" src="%%appcore%%/js/jquery-autogrow.js" index="50"></script>
<script type="text/javascript" src="%%appcore%%/js/jquery-scrollto.js" index="50"></script>
<script type="text/javascript" src="%%appcore%%/js/jquery.tmpl.min.js" index="50"></script>
